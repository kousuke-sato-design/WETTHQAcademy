# WEBTHQAcademy 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
WEBTHQAcademy

### 1.2 目的
企業向けのストレスチェック知識補完サイトを構築する。動画とテキストコンテンツを通じて、ストレスチェックに関する理解を深めることができるプラットフォームを提供する。

### 1.3 対象ユーザー
- **契約済み企業**: 既に契約している企業向けのクローズドサービス
- **3つのユーザータイプ**:
  1. マスター管理者（システム全体の管理者）
  2. 企業担当者（各企業の担当者）
  3. 一般利用者（将来実装予定）

### 1.4 開発フェーズ
プロトタイプ版（MVP）

---

## 2. 機能要件

### 2.1 認証機能

#### 2.1.1 ログイン方式
- **3つの独立したログインURL**:
  - `/login/master` - マスター管理者用
  - `/login/company` - 企業担当者用
  - `/login/user` - 一般利用者用（将来実装）
- **認証方式**: ログインID + パスワード
- **実装方法**: データベース照合によるシンプルな認証
- **除外機能**:
  - メール認証なし
  - パスワードリセット機能なし（プロトタイプ版では除外）

#### 2.1.2 ユーザーロールと権限

| 機能 | マスター管理者 | 企業担当者 | 一般利用者(将来) |
|------|----------------|------------|------------------|
| ログインURL | /login/master | /login/company | /login/user |
| コンテンツ閲覧 | ✅ | ✅ | ✅ |
| 全企業データ閲覧 | ✅ | ❌ | ❌ |
| 企業管理機能 | ✅ | ❌ | ❌ |
| コンテンツ管理 | ✅ | ❌ | ❌ |

#### 2.1.3 セッション管理
- ログイン状態の保持
- ロールベースのアクセス制御
- ログアウト機能

### 2.2 コンテンツ閲覧機能

#### 2.2.1 動画コンテンツ
- ストレスチェックに関する解説動画の視聴
- 想定コンテンツ数: 約10本（各10分程度）
- YouTube埋め込み形式での配信

#### 2.2.2 テキストコンテンツ
- ストレスチェックに関する記事・資料の閲覧
- マークダウン形式での表示

#### 2.2.3 コンテンツ構成
- カテゴリ分け（基礎知識、実施方法、法令など）
- コンテンツ一覧表示
- 詳細ページ表示

---

## 3. 非機能要件

### 3.1 技術スタック

#### 3.1.1 フロントエンド
- **フレームワーク**: SvelteKit
- **スタイリング**: Tailwind CSS
- **言語**: TypeScript

#### 3.1.2 バックエンド
- **BaaS/Database**: Turso (Serverless SQLite)
  - リージョン: AP NorthEast (Tokyo)
  - プラン: Starter（無料プラン）
  - 容量: 5GB storage
  - データベース数: 100
  - 月間読み取り: 500M rows
  - 月間書き込み: 10M rows

#### 3.1.3 ファイルストレージ
- **動画保存**: YouTube (unlisted)
  - 容量無制限
  - 無料
  - 埋め込み配信

#### 3.1.4 ホスティング
- **プラットフォーム**: Vercel
- **デプロイ**: 自動デプロイ（Git連携）

#### 3.1.5 ORM/Database Client
- Drizzle ORM または Prisma（選定予定）

### 3.2 パフォーマンス要件
- ページロード時間: 3秒以内
- 動画ストリーミング: YouTube CDN経由で配信

### 3.3 セキュリティ要件
- パスワードのハッシュ化（bcrypt または argon2）
- HTTPS通信
- 環境変数での機密情報管理
- XSS対策（SvelteKitのデフォルト機能）

### 3.4 可用性
- データベース: 常時稼働（停止なし）
- アップタイム目標: 99%以上（Vercel SLA準拠）

---

## 4. データベース設計

### 4.1 テーブル構成

#### 4.1.1 users テーブル
全ユーザー（マスター、企業担当者、一般利用者）を管理

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|-----|------|
| id | INTEGER | PRIMARY KEY, AUTO INCREMENT | 内部ID |
| login_id | TEXT | UNIQUE, NOT NULL | ログイン用ID |
| password_hash | TEXT | NOT NULL | ハッシュ化されたパスワード |
| role | TEXT | NOT NULL | 'master', 'company_admin', 'user' |
| company_id | INTEGER | FOREIGN KEY (companies.id), NULL | 所属企業ID（企業ユーザーのみ） |
| name | TEXT | NOT NULL | 表示名 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新日時 |

#### 4.1.2 companies テーブル
企業情報を管理

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|-----|------|
| id | INTEGER | PRIMARY KEY, AUTO INCREMENT | 内部ID |
| company_name | TEXT | NOT NULL | 企業名 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新日時 |

#### 4.1.3 contents テーブル
コンテンツ情報を管理

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|-----|------|
| id | INTEGER | PRIMARY KEY, AUTO INCREMENT | コンテンツID |
| title | TEXT | NOT NULL | タイトル |
| description | TEXT | | 説明 |
| content_type | TEXT | NOT NULL | 'video' or 'text' |
| content_url | TEXT | NOT NULL | YouTube URL または テキストパス |
| category | TEXT | | カテゴリ |
| order | INTEGER | DEFAULT 0 | 表示順序 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 作成日時 |

---

## 5. 画面設計

### 5.1 レイアウト構成

全ての認証後画面は**3カラムレイアウト**を採用

```
┌─────────────────────────────────────────────────────────┐
│  Header (ロゴ、ユーザー名、ログアウト)                    │
├──────────┬─────────────────────────────┬─────────────────┤
│          │                             │                 │
│ Sidebar  │    Main Content             │  Right Widget   │
│ (左)     │    (中央)                   │  (右)           │
│          │                             │                 │
│ ナビゲ   │    ページコンテンツ          │  おすすめ       │
│ ーション │    (動的に変化)              │  関連情報       │
│          │                             │  カテゴリ一覧   │
│          │                             │                 │
└──────────┴─────────────────────────────┴─────────────────┘
```

#### 5.1.1 Sidebar（サイドバー）- 左カラム
- ダッシュボード
- コンテンツ一覧
- カテゴリ別表示
- **マスター管理者のみ**:
  - 企業管理
  - コンテンツ管理
  - ユーザー管理

#### 5.1.2 Main Content（メインコンテンツ）- 中央カラム
ページに応じて動的に変化
- ダッシュボード
- コンテンツ一覧
- コンテンツ詳細（動画/テキスト）
- 管理画面（マスターのみ）

#### 5.1.3 Right Widget（ウィジェット）- 右カラム
- おすすめコンテンツ
- 最近見たコンテンツ
- カテゴリ一覧
- お知らせ
- 学習進捗（将来実装）

### 5.2 画面一覧

#### 5.2.1 ランディングページ (`/`)
**認証前のトップページ**
- サイト説明
- 3つのログインボタン:
  - マスター管理者ログイン → `/login/master`
  - 企業担当者ログイン → `/login/company`
  - 一般利用者ログイン → `/login/user`（準備中表示）

```
┌─────────────────────────────────────────┐
│         WEBTHQAcademy                   │
│  ストレスチェック知識補完プラットフォーム │
├─────────────────────────────────────────┤
│  【このサイトについて】                  │
│  ストレスチェックの実施方法や関連法令を   │
│  動画とテキストで学習できる              │
│  契約企業様専用サイトです                │
│                                         │
│  ┌─────────────────────────────┐      │
│  │  🔧 マスター管理者ログイン   │      │
│  └─────────────────────────────┘      │
│  ┌─────────────────────────────┐      │
│  │  🏢 企業担当者ログイン       │      │
│  └─────────────────────────────┘      │
│  ┌─────────────────────────────┐      │
│  │  👤 一般利用者ログイン (準備中)│     │
│  └─────────────────────────────┘      │
└─────────────────────────────────────────┘
```

#### 5.2.2 ログイン画面 (`/login/master`, `/login/company`, `/login/user`)
- ログインIDフィールド
- パスワードフィールド
- ログインボタン
- エラーメッセージ表示エリア
- トップに戻るリンク

#### 5.2.3 ダッシュボード (`/dashboard`)
**3カラムレイアウト適用**
- おすすめコンテンツ
- 最近追加されたコンテンツ
- カテゴリ別コンテンツ数

#### 5.2.4 コンテンツ一覧画面 (`/contents`)
**3カラムレイアウト適用**
- カテゴリフィルター
- コンテンツカード一覧（サムネイル、タイトル、説明）

#### 5.2.5 動画視聴画面 (`/contents/[id]`)
**3カラムレイアウト適用**
- YouTube埋め込みプレイヤー
- タイトル・説明表示
- 右ウィジェット: 関連コンテンツ一覧

#### 5.2.6 テキスト閲覧画面 (`/contents/[id]`)
**3カラムレイアウト適用**
- マークダウンレンダリング
- タイトル・説明表示
- 右ウィジェット: 関連コンテンツ一覧

#### 5.2.7 管理画面 (`/admin/*`) - マスター管理者のみ
**3カラムレイアウト適用**
- 企業管理
- ユーザー管理
- コンテンツ管理

---

## 6. 開発スコープ

### 6.1 プロトタイプ版に含む機能
- ✅ ランディングページ（3つのログインボタン）
- ✅ 3つの独立したログインページ（/login/master, /login/company, /login/user）
- ✅ ロールベースの認証システム
- ✅ セッション管理
- ✅ 3カラムレイアウト（Sidebar + Main + Widget）
- ✅ 動画コンテンツ閲覧（YouTube埋め込み）
- ✅ テキストコンテンツ閲覧
- ✅ カテゴリ別コンテンツ表示
- ✅ レスポンシブデザイン（Tailwind CSS）
- ✅ マスター管理者専用機能（企業管理、コンテンツ管理）

### 6.2 プロトタイプ版に含まない機能
- ❌ 一般利用者ログイン（準備中表示のみ）
- ❌ メール認証
- ❌ パスワードリセット
- ❌ 学習進捗管理
- ❌ コメント機能
- ❌ コンテンツ検索機能
- ❌ ブックマーク機能

### 6.3 将来的な拡張予定
- 個人ユーザーアカウント機能
- 学習進捗トラッキング
- 修了証発行機能
- 管理画面でのコンテンツ管理
- アクセス解析

---

## 7. 環境変数

### 7.1 必須環境変数

```bash
# Turso Database
TURSO_DATABASE_URL="libsql://webthq-academy-db-vercel-icfg-ubzduo0p4hkfrtrk24mdcbwv.aws-ap-northeast-1.turso.io"
TURSO_AUTH_TOKEN="[認証トークン]"

# Session Secret
SESSION_SECRET="[ランダム生成文字列]"
```

---

## 8. デプロイメント

### 8.1 デプロイフロー
1. GitHub リポジトリへのプッシュ
2. Vercel 自動ビルド
3. プロダクション環境へのデプロイ

### 8.2 環境
- **開発環境**: ローカル（localhost:5173）
- **本番環境**: Vercel（*.vercel.app）

---

## 9. プロジェクト構成（予定）

```
WEBTHQAcademy/
├── src/
│   ├── lib/
│   │   ├── db/
│   │   │   └── turso.ts             # Turso接続設定
│   │   ├── auth/
│   │   │   └── auth.ts              # 認証ロジック
│   │   └── components/
│   │       ├── layout/
│   │       │   ├── Header.svelte    # ヘッダー
│   │       │   ├── Sidebar.svelte   # サイドバー（左カラム）
│   │       │   ├── Widget.svelte    # ウィジェット（右カラム）
│   │       │   └── Layout.svelte    # 3カラムレイアウト
│   │       ├── ContentCard.svelte
│   │       └── VideoPlayer.svelte
│   ├── routes/
│   │   ├── +page.svelte                    # ランディングページ
│   │   ├── login/
│   │   │   ├── master/
│   │   │   │   └── +page.svelte            # マスター管理者ログイン
│   │   │   ├── company/
│   │   │   │   └── +page.svelte            # 企業担当者ログイン
│   │   │   └── user/
│   │   │       └── +page.svelte            # 一般利用者ログイン（準備中）
│   │   ├── dashboard/
│   │   │   └── +page.svelte                # ダッシュボード
│   │   ├── contents/
│   │   │   ├── +page.svelte                # コンテンツ一覧
│   │   │   └── [id]/
│   │   │       └── +page.svelte            # コンテンツ詳細
│   │   └── admin/                          # マスター管理者のみ
│   │       ├── companies/
│   │       │   └── +page.svelte            # 企業管理
│   │       ├── users/
│   │       │   └── +page.svelte            # ユーザー管理
│   │       └── contents/
│   │           └── +page.svelte            # コンテンツ管理
│   └── app.html
├── static/
├── drizzle/
│   └── schema.ts                            # DBスキーマ定義
├── .env.local                               # ローカル環境変数
├── package.json
├── svelte.config.js
├── tailwind.config.js
├── tsconfig.json
└── claude.md                                # 本ドキュメント
```

---

## 10. 開発スケジュール（想定）

### Phase 1: 環境構築（1日）
- SvelteKitプロジェクト初期化
- Tailwind CSS設定
- Turso接続設定

### Phase 2: 認証機能（1日）
- データベーススキーマ作成
- ログイン機能実装
- セッション管理実装

### Phase 3: コンテンツ表示（2日）
- コンテンツ一覧画面
- 動画視聴画面（YouTube埋め込み）
- テキスト閲覧画面

### Phase 4: デザイン調整（1日）
- レスポンシブ対応
- UI/UX改善

### Phase 5: デプロイ（0.5日）
- Vercelデプロイ
- 環境変数設定
- 動作確認

**合計: 約5.5日**

---

## 11. 成功指標

### 11.1 プロトタイプ版の成功基準
- ログイン機能が正常に動作する
- 全ての動画コンテンツが視聴可能
- モバイル・デスクトップ両方で表示可能
- ページロード時間が3秒以内
- データベースが安定稼働（停止なし）

---

## 12. リスクと対策

### 12.1 技術的リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Turso無料枠の制限超過 | 中 | 使用量モニタリング、必要に応じてプラン変更 |
| YouTube動画の削除・非公開化 | 高 | バックアップ動画の保持、Cloudflare R2への移行検討 |
| Vercel無料枠の帯域制限 | 低 | 使用量モニタリング |

### 12.2 セキュリティリスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 企業IDの漏洩 | 高 | 強固なパスワードポリシー、定期的なパスワード変更推奨 |
| セッションハイジャック | 中 | HTTPS必須、セッショントークンの暗号化 |

---

## 13. ルーティング設計

### 13.1 ルート一覧

| URL | 認証 | ロール | 説明 |
|-----|------|--------|------|
| `/` | 不要 | - | ランディングページ |
| `/login/master` | 不要 | - | マスター管理者ログイン |
| `/login/company` | 不要 | - | 企業担当者ログイン |
| `/login/user` | 不要 | - | 一般利用者ログイン（準備中） |
| `/dashboard` | 必要 | 全て | ダッシュボード |
| `/contents` | 必要 | 全て | コンテンツ一覧 |
| `/contents/[id]` | 必要 | 全て | コンテンツ詳細 |
| `/admin/companies` | 必要 | master | 企業管理 |
| `/admin/users` | 必要 | master | ユーザー管理 |
| `/admin/contents` | 必要 | master | コンテンツ管理 |

### 13.2 認証ガード
- 未認証ユーザーが認証必須ページにアクセス → `/login/company` へリダイレクト
- master以外が `/admin/*` にアクセス → `/dashboard` へリダイレクト

---

## 14. 変更履歴

| 日付 | バージョン | 変更内容 | 担当 |
|------|-----------|---------|------|
| 2025-11-08 | 1.0 | 初版作成 | - |
| 2025-11-08 | 1.1 | 3カラムレイアウト、ロールベース認証、ルーティング設計追加 | - |

---

## 15. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロダクトオーナー | | | |
| 開発責任者 | | | |

---

**Document End**
